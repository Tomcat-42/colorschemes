#!/usr/bin/env bash
# Auto-generate .gitignore based on custom themes in base16/schemes/

set -e

REPO_ROOT="$(git rev-parse --show-toplevel)"
SCHEMES_DIR="$REPO_ROOT/base16/schemes"
GITIGNORE="$REPO_ROOT/.gitignore"

# Extract theme names from base16/schemes (e.g., "darkbox" from "darkbox.yml")
get_custom_themes() {
    for f in "$SCHEMES_DIR"/*.yml; do
        basename "$f" .yml
    done | sort -u
}

THEMES=$(get_custom_themes)

# Generate .gitignore content
cat > "$GITIGNORE" << 'HEADER'
# Auto-generated by .githooks/pre-commit
# Do not edit manually - add custom themes to base16/schemes/ instead

HEADER

# base16/schemes (no base16- prefix in filenames)
{
    echo "# base16 schemes"
    echo "base16/schemes/*.yml"
    for theme in $THEMES; do
        echo "!base16/schemes/${theme}.yml"
    done
    echo ""
} >> "$GITIGNORE"

# fish
{
    echo "# fish"
    echo "fish/functions/base16-*.fish"
    for theme in $THEMES; do
        echo "!fish/functions/base16-${theme}.fish"
    done
    echo ""
} >> "$GITIGNORE"

# ghostty
{
    echo "# ghostty"
    echo "ghostty/colors/base16-*.conf"
    for theme in $THEMES; do
        echo "!ghostty/colors/base16-${theme}.conf"
    done
    echo ""
} >> "$GITIGNORE"

# tmux
{
    echo "# tmux"
    echo "tmux/colors/base16-*.tmux.conf"
    for theme in $THEMES; do
        echo "!tmux/colors/base16-${theme}.tmux.conf"
    done
    echo ""
} >> "$GITIGNORE"

# zathura
{
    echo "# zathura"
    echo "zathura/colors/base16-*"
    for theme in $THEMES; do
        echo "!zathura/colors/base16-${theme}"
    done
    echo ""
} >> "$GITIGNORE"

# Stage .gitignore if it changed
git add "$GITIGNORE" 2>/dev/null || true
